{
  "version": 3,
  "sources": ["../bin/live-reload.js", "../src/utils/gravatar.ts", "../src/utils/copyright.ts", "../src/utils/customfields.ts", "../src/utils/members.ts", "../src/utils/plan.ts", "../src/index.ts"],
  "sourcesContent": ["new EventSource(`${SERVE_ORIGIN}/esbuild`).addEventListener('change', () => location.reload());\n", "export async function updateGravatarImages(email: string) {\n  const encodedEmail = encodeURIComponent(email);\n  const endpoint = `https://gravatar.helpers.wipn.org/?email=${encodedEmail}`;\n\n  // Select all elements with the `data-element=\"gravatar\"` attribute\n  const gravatarImages = document.querySelectorAll('[data-element=\"gravatar\"]');\n\n  // Iterate over the NodeList and update each image source\n  gravatarImages.forEach((image) => {\n    image.src = endpoint;\n  });\n}\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  // Example usage with MemberStack\n  window.$memberstackDom.getCurrentMember().then(({ data: member }) => {\n    if (member && member.auth.email) {\n      updateGravatarImages(member.auth.email);\n    }\n  });\n});\n", "function updateCopyright(selector: string = '[data-element=\"copyright\"]'): void {\n  const currentYear: number = new Date().getFullYear();\n  const copyrightDateElement: HTMLElement | null = document.querySelector(selector);\n\n  if (copyrightDateElement) {\n    copyrightDateElement.textContent = currentYear.toString();\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  updateCopyright();\n});\n", "// Define an interface for the structure of Memberstack data\ninterface MemberstackData {\n  customFields?: { [key: string]: string | undefined };\n}\n\n(function () {\n  document.addEventListener('DOMContentLoaded', function () {\n    // Get the `_ms-mem` object from the local storage\n    const msMemString = localStorage.getItem('_ms-mem');\n    const msMem: MemberstackData = msMemString ? JSON.parse(msMemString) : {};\n\n    // Get all the elements that have the `ms-code-customfield` attribute\n    const elements = document.querySelectorAll<HTMLElement>('[ms-code-customfield]');\n\n    // Iterate over each element\n    elements.forEach((element) => {\n      // Get the value of the `ms-code-customfield` attribute\n      const customField = element.getAttribute('ms-code-customfield');\n\n      if (customField) {\n        // If customField starts with '!', we invert the logic\n        if (customField.startsWith('!')) {\n          const actualCustomField = customField.slice(1); // remove the '!' from the start\n\n          // If the custom field is empty, remove the element from the DOM\n          if (msMem.customFields && msMem.customFields[actualCustomField]) {\n            element.parentNode?.removeChild(element);\n          }\n        } else {\n          // Check if the user has the corresponding custom field in Memberstack\n          if (!msMem.customFields || !msMem.customFields[customField]) {\n            // If the custom field is empty, remove the element from the DOM\n            element.parentNode?.removeChild(element);\n          }\n        }\n      }\n    });\n  });\n})();\n", "/**\n * Fetches members from MemberStack (using Cloudflare Worker Proxy)\n * @returns An array of {@link Member}.\n */\nexport async function fetchMembers(query: string) {\n  try {\n    const response = await fetch(`https://members.helpers.wipn.org/${query}`);\n    const data = await response.json();\n    return data;\n  } catch (error) {\n    return error;\n  }\n}\n", "interface PaymentDetails {\n  amount: number;\n  nextBillingDate: number; // Unix timestamp\n}\n\ninterface PlanConnection {\n  active: boolean;\n  status: string;\n  payment?: PaymentDetails;\n}\n\ninterface MemberData {\n  planConnections: PlanConnection[];\n}\n\nfunction formatDate(timestamp: number): string {\n  const date = new Date(timestamp * 1000);\n  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };\n  return date.toLocaleDateString('en-US', options);\n}\nfunction updatePlanDetails(\n  member: MemberData,\n  priceSelector: string = '[data-element=\"plan-price\"]',\n  renewalSelector: string = '[data-element=\"plan-renewal\"]'\n): void {\n  // Include plans that are either active or in TRIALING status\n  const relevantPlans = member.planConnections.filter(\n    (pc) => (pc.active || pc.status === 'TRIALING') && pc.payment && pc.payment.nextBillingDate\n  );\n\n  // Sort by nextBillingDate descending (most recent first)\n  const sortedPlans = relevantPlans.sort(\n    (a, b) => b.payment.nextBillingDate - a.payment.nextBillingDate\n  );\n\n  // Take the first plan (most recent one)\n  const currentPlan = sortedPlans[0];\n  console.log('current', currentPlan);\n  console.log('date', formatDate(currentPlan.payment.nextBillingDate));\n\n  const priceElement = document.querySelector(priceSelector);\n  const renewalElement = document.querySelector(renewalSelector);\n\n  if (currentPlan && currentPlan.payment) {\n    if (priceElement) {\n      priceElement.textContent = `$${currentPlan.payment.amount}`;\n    }\n\n    if (renewalElement) {\n      const formattedDate = formatDate(currentPlan.payment.nextBillingDate);\n      renewalElement.textContent = formattedDate;\n    }\n  } else {\n    // Handle case where there is no current plan or payment details\n    if (priceElement) {\n      priceElement.textContent = 'Free';\n    }\n    if (renewalElement) {\n      renewalElement.textContent = 'N/A';\n    }\n  }\n}\n\nexport { updatePlanDetails };\n", "import '$utils/gravatar';\nimport '$utils/copyright';\nimport '$utils/customfields';\n\nimport { fetchMembers } from '$utils/members';\nimport { updatePlanDetails } from '$utils/plan';\n\nimport type { CMSFilters } from '../types/CMSFilters';\nimport type { Member } from '../types/Member';\n\nconst memberstack = window.$memberstackDom;\n/**\n * Get and replace the current plan details.\n */\ndocument.addEventListener('DOMContentLoaded', function () {\n  memberstack.getCurrentMember().then(({ data: member }) => {\n    updatePlanDetails(member);\n  });\n});\n\n/**\n * Populate CMS Data from an external API.\n */\nwindow.fsAttributes = window.fsAttributes || [];\nwindow.fsAttributes.push([\n  'cmsfilter',\n  async (filtersInstances: CMSFilters[]) => {\n    // Get the filters instance\n    const [filtersInstance] = filtersInstances;\n\n    // Get the list instance\n    const { listInstance } = filtersInstance;\n\n    // Save a copy of the template\n    const [firstItem] = listInstance.items;\n    const itemTemplateElement = firstItem.element;\n\n    // Fetch external data\n    const members = await fetchMembers();\n\n    // Remove existing items\n    listInstance.clearItems();\n\n    // Create the new items\n    const newItems = members.map((member) => createItem(member, itemTemplateElement));\n\n    // Populate the list\n    await listInstance.addItems(newItems);\n\n    // Get the template filter\n    const filterTemplateElement =\n      filtersInstance.form.querySelector<HTMLLabelElement>('[data-element=\"filter\"]');\n    if (!filterTemplateElement) return;\n\n    // Get the parent wrapper\n    const filtersWrapper = filterTemplateElement.parentElement;\n    if (!filtersWrapper) return;\n\n    // Remove the template from the DOM\n    filterTemplateElement.remove();\n\n    // Sync the CMSFilters instance with the new created filters\n    // filtersInstance.storeFiltersData();\n  },\n]);\n\n/**\n * Creates an item from the template element.\n * @param member The member data to create the item from.\n * @param templateElement The template element.\n *\n * @returns A new Collection Item element.\n */\nconst createItem = (member: Member, templateElement: HTMLDivElement) => {\n  // Clone the template element\n  const newItem = templateElement.cloneNode(true) as HTMLDivElement;\n\n  // Query inner elements\n  const firstName = newItem.querySelector<HTMLSpanElement>('[data-element=\"first-name\"]');\n  const lastName = newItem.querySelector<HTMLSpanElement>('[data-element=\"last-name\"]');\n  const chapter = newItem.querySelector<HTMLParagraphElement>('[data-element=\"chapter\"]');\n  const company = newItem.querySelector<HTMLParagraphElement>('[data-element=\"company\"]');\n\n  // Populate inner elements\n  if (firstName) firstName.textContent = member.firstName;\n  if (lastName) lastName.textContent = member.lastName;\n  if (chapter) {\n    chapter.textContent = 'National Virtual';\n    if (member.chapter) {\n      chapter.textContent = member.chapter;\n    }\n  }\n  if (company) {\n    if (member.company) {\n      company.textContent = member.company;\n    } else {\n      company.style.display = 'none';\n    }\n  }\n\n  return newItem;\n};\nfunction whenLoaded(arg0: () => void, arg1: () => any) {\n  throw new Error('Function not implemented.');\n}\n"],
  "mappings": ";;;AAAA,MAAI,YAAY,GAAG,uBAAY,UAAU,EAAE,iBAAiB,UAAU,MAAM,SAAS,OAAO,CAAC;;;ACA7F,iBAAsB,qBAAqB,OAAe;AACxD,UAAM,eAAe,mBAAmB,KAAK;AAC7C,UAAM,WAAW,4CAA4C,YAAY;AAGzE,UAAM,iBAAiB,SAAS,iBAAiB,2BAA2B;AAG5E,mBAAe,QAAQ,CAAC,UAAU;AAChC,YAAM,MAAM;AAAA,IACd,CAAC;AAAA,EACH;AAEA,WAAS,iBAAiB,oBAAoB,WAAY;AAExD,WAAO,gBAAgB,iBAAiB,EAAE,KAAK,CAAC,EAAE,MAAM,OAAO,MAAM;AACnE,UAAI,UAAU,OAAO,KAAK,OAAO;AAC/B,6BAAqB,OAAO,KAAK,KAAK;AAAA,MACxC;AAAA,IACF,CAAC;AAAA,EACH,CAAC;;;ACpBD,WAAS,gBAAgB,WAAmB,8BAAoC;AAC9E,UAAM,eAAsB,oBAAI,KAAK,GAAE,YAAY;AACnD,UAAM,uBAA2C,SAAS,cAAc,QAAQ;AAEhF,QAAI,sBAAsB;AACxB,2BAAqB,cAAc,YAAY,SAAS;AAAA,IAC1D;AAAA,EACF;AAEA,WAAS,iBAAiB,oBAAoB,WAAY;AACxD,oBAAgB;AAAA,EAClB,CAAC;;;ACND,GAAC,WAAY;AACX,aAAS,iBAAiB,oBAAoB,WAAY;AAExD,YAAM,cAAc,aAAa,QAAQ,SAAS;AAClD,YAAM,QAAyB,cAAc,KAAK,MAAM,WAAW,IAAI,CAAC;AAGxE,YAAM,WAAW,SAAS,iBAA8B,uBAAuB;AAG/E,eAAS,QAAQ,CAAC,YAAY;AAE5B,cAAM,cAAc,QAAQ,aAAa,qBAAqB;AAE9D,YAAI,aAAa;AAEf,cAAI,YAAY,WAAW,GAAG,GAAG;AAC/B,kBAAM,oBAAoB,YAAY,MAAM,CAAC;AAG7C,gBAAI,MAAM,gBAAgB,MAAM,aAAa,iBAAiB,GAAG;AAC/D,sBAAQ,YAAY,YAAY,OAAO;AAAA,YACzC;AAAA,UACF,OAAO;AAEL,gBAAI,CAAC,MAAM,gBAAgB,CAAC,MAAM,aAAa,WAAW,GAAG;AAE3D,sBAAQ,YAAY,YAAY,OAAO;AAAA,YACzC;AAAA,UACF;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAAA,EACH,GAAG;;;AClCH,iBAAsB,aAAa,OAAe;AAChD,QAAI;AACF,YAAM,WAAW,MAAM,MAAM,oCAAoC,KAAK,EAAE;AACxE,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAO;AAAA,IACT,SAAS,OAAO;AACd,aAAO;AAAA,IACT;AAAA,EACF;;;ACGA,WAAS,WAAW,WAA2B;AAC7C,UAAM,OAAO,IAAI,KAAK,YAAY,GAAI;AACtC,UAAM,UAAsC,EAAE,MAAM,WAAW,OAAO,QAAQ,KAAK,UAAU;AAC7F,WAAO,KAAK,mBAAmB,SAAS,OAAO;AAAA,EACjD;AACA,WAAS,kBACP,QACA,gBAAwB,+BACxB,kBAA0B,iCACpB;AAEN,UAAM,gBAAgB,OAAO,gBAAgB;AAAA,MAC3C,CAAC,QAAQ,GAAG,UAAU,GAAG,WAAW,eAAe,GAAG,WAAW,GAAG,QAAQ;AAAA,IAC9E;AAGA,UAAM,cAAc,cAAc;AAAA,MAChC,CAAC,GAAG,MAAM,EAAE,QAAQ,kBAAkB,EAAE,QAAQ;AAAA,IAClD;AAGA,UAAM,cAAc,YAAY,CAAC;AACjC,YAAQ,IAAI,WAAW,WAAW;AAClC,YAAQ,IAAI,QAAQ,WAAW,YAAY,QAAQ,eAAe,CAAC;AAEnE,UAAM,eAAe,SAAS,cAAc,aAAa;AACzD,UAAM,iBAAiB,SAAS,cAAc,eAAe;AAE7D,QAAI,eAAe,YAAY,SAAS;AACtC,UAAI,cAAc;AAChB,qBAAa,cAAc,IAAI,YAAY,QAAQ,MAAM;AAAA,MAC3D;AAEA,UAAI,gBAAgB;AAClB,cAAM,gBAAgB,WAAW,YAAY,QAAQ,eAAe;AACpE,uBAAe,cAAc;AAAA,MAC/B;AAAA,IACF,OAAO;AAEL,UAAI,cAAc;AAChB,qBAAa,cAAc;AAAA,MAC7B;AACA,UAAI,gBAAgB;AAClB,uBAAe,cAAc;AAAA,MAC/B;AAAA,IACF;AAAA,EACF;;;ACnDA,MAAM,cAAc,OAAO;AAI3B,WAAS,iBAAiB,oBAAoB,WAAY;AACxD,gBAAY,iBAAiB,EAAE,KAAK,CAAC,EAAE,MAAM,OAAO,MAAM;AACxD,wBAAkB,MAAM;AAAA,IAC1B,CAAC;AAAA,EACH,CAAC;AAKD,SAAO,eAAe,OAAO,gBAAgB,CAAC;AAC9C,SAAO,aAAa,KAAK;AAAA,IACvB;AAAA,IACA,OAAO,qBAAmC;AAExC,YAAM,CAAC,eAAe,IAAI;AAG1B,YAAM,EAAE,aAAa,IAAI;AAGzB,YAAM,CAAC,SAAS,IAAI,aAAa;AACjC,YAAM,sBAAsB,UAAU;AAGtC,YAAM,UAAU,MAAM,aAAa;AAGnC,mBAAa,WAAW;AAGxB,YAAM,WAAW,QAAQ,IAAI,CAAC,WAAW,WAAW,QAAQ,mBAAmB,CAAC;AAGhF,YAAM,aAAa,SAAS,QAAQ;AAGpC,YAAM,wBACJ,gBAAgB,KAAK,cAAgC,yBAAyB;AAChF,UAAI,CAAC;AAAuB;AAG5B,YAAM,iBAAiB,sBAAsB;AAC7C,UAAI,CAAC;AAAgB;AAGrB,4BAAsB,OAAO;AAAA,IAI/B;AAAA,EACF,CAAC;AASD,MAAM,aAAa,CAAC,QAAgB,oBAAoC;AAEtE,UAAM,UAAU,gBAAgB,UAAU,IAAI;AAG9C,UAAM,YAAY,QAAQ,cAA+B,6BAA6B;AACtF,UAAM,WAAW,QAAQ,cAA+B,4BAA4B;AACpF,UAAM,UAAU,QAAQ,cAAoC,0BAA0B;AACtF,UAAM,UAAU,QAAQ,cAAoC,0BAA0B;AAGtF,QAAI;AAAW,gBAAU,cAAc,OAAO;AAC9C,QAAI;AAAU,eAAS,cAAc,OAAO;AAC5C,QAAI,SAAS;AACX,cAAQ,cAAc;AACtB,UAAI,OAAO,SAAS;AAClB,gBAAQ,cAAc,OAAO;AAAA,MAC/B;AAAA,IACF;AACA,QAAI,SAAS;AACX,UAAI,OAAO,SAAS;AAClB,gBAAQ,cAAc,OAAO;AAAA,MAC/B,OAAO;AACL,gBAAQ,MAAM,UAAU;AAAA,MAC1B;AAAA,IACF;AAEA,WAAO;AAAA,EACT;",
  "names": []
}
